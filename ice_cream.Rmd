---
title: "ice_cream_example"
output: html_document
---


#### NOTES
# do we need several samples to do this analysis? not just one sample... FIX

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(DT)
```

# Read in the data

* id: Identity of student
* female: Gender (0: male, 1: female)
* ice_cream: Favorite flavor (0: vanilla, 1: chocolate, 2: strawberry)
* video: score on video game
* puzzle: score on puzzle

```{r}

ice_cream <- read.csv("~/Downloads/Ice_cream_R.csv")

DT::datatable(ice_cream)

```

# Lecture 01

## What type of variables are in our dataframe?

* id: numeric/discrete
* female: numeric/discrete
* ice_cream: numeric/discrete
* video: numeric/continuous
* puzzle: numeric/continuous

## What is the shape, center, and spread of the four variables?

### Female

```{r}

table(ice_cream$female)

ice_cream %>%
    dplyr::mutate(female = dplyr::recode(female, "0" = "Male", "1" = "Female")) %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = female, fill = female) +
    ggplot2::geom_bar(color = "black") +
    ggplot2::theme_bw(24) +
    ggplot2::scale_fill_manual(values = c("Female" = "pink", "Male" = "skyblue"),
                               name = "Gender") +
    ggplot2::labs(x = "Gender", y = "Count") +
    ggplot2::theme(legend.position = 'none')

```

### Ice cream flavor

```{r}

table(ice_cream$ice_cream)

ice_cream %>%
    dplyr::mutate(ice_cream = dplyr::recode(ice_cream, "1" = "Vanilla", 
                                            "2" = "Chocolate",
                                            "3" = "Strawberry")) %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = ice_cream, fill = ice_cream) +
    ggplot2::geom_bar(color = "black") +
    ggplot2::theme_bw(24) +
    ggplot2::scale_fill_manual(values = c("Vanilla" = "grey100", "Chocolate" = "chocolate4",
                                          "Strawberry" = "maroon3"),
                               name = "Gender") +
    ggplot2::labs(x = "Ice cream flavor", y = "Count") +
    ggplot2::theme(legend.position = 'none')

```

### Video score

```{r}

# note we can use summary here instead of table because it is a continuous variable (not discrete)
summary(ice_cream$video)

# histogram
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = video) +
    ggplot2::geom_histogram(bins = 20, fill = "chartreuse4") +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "Video score", y = "Count")

# measures of spread
var(ice_cream$video)
sd(ice_cream$video)

# histogram with mean and sd plotted on top
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = video) +
    ggplot2::geom_histogram(bins = 20, fill = "chartreuse4") +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "Video score", y = "Count") +
    ggplot2::geom_vline(xintercept = mean(ice_cream$video), color = "blue", size = 2) +
    ggplot2::geom_vline(xintercept = c(mean(ice_cream$video) + sd(ice_cream$video),
                                       mean(ice_cream$video) - sd(ice_cream$video)), color = "black", size = 1.5, linetype = 2)

# box plot
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = "1", y = video) +
    ggplot2::geom_jitter(width = 0.2) +
    ggplot2::geom_boxplot(alpha = 0.5) +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "", y = "Video score") +
    ggplot2::theme(legend.position = 'none',
                   axis.text.x = element_blank(),
                   axis.title.x = element_blank(),
                   axis.ticks.x = element_blank())


```

### Puzzle score

```{r}

# note we can use summary here instead of table because it is a continuous variable (not discrete)
summary(ice_cream$puzzle)

# histogram
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = puzzle) +
    ggplot2::geom_histogram(bins = 20, fill = "aquamarine4") +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "Puzzle score", y = "Count")

# redo histogram with less bins!
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = puzzle) +
    ggplot2::geom_histogram(bins = 10, fill = "aquamarine4") +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "Puzzle score", y = "Count")

# measures of spread
var(ice_cream$puzzle)
sd(ice_cream$puzzle)

# histogram with mean and sd plotted on top
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = puzzle) +
    ggplot2::geom_histogram(bins = 10, fill = "aquamarine4") +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "Video score", y = "Count") +
    ggplot2::geom_vline(xintercept = mean(ice_cream$puzzle), color = "blue", size = 2) +
    ggplot2::geom_vline(xintercept = c(mean(ice_cream$puzzle) + sd(ice_cream$puzzle),
                                       mean(ice_cream$puzzle) - sd(ice_cream$puzzle)), color = "black", size = 1.5, linetype = 2)

# box plot
ice_cream %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = "1", y = puzzle) +
    ggplot2::geom_jitter(width = 0.2) +
    ggplot2::geom_boxplot(alpha = 0.5) +
    ggplot2::theme_bw(24) +
    ggplot2::labs(x = "", y = "Puzzle score") +
    ggplot2::theme(legend.position = 'none',
                   axis.text.x = element_blank(),
                   axis.title.x = element_blank(),
                   axis.ticks.x = element_blank())


```

# Lecture 02

## Probability

If you find an individual whose favorite flavor is chocolate, what is the probability that the individual is male?
What is the probability of sellecting an individual that is both male and enjoys chocolate?

```{r}

# chocolate is 2 - 47/200 people like chocolate
table(ice_cream$ice_cream)

# what is the gender breakdown by flavor?
test <- ice_cream %>%
    dplyr::mutate(ice_cream = dplyr::recode(ice_cream, "1" = "Vanilla", 
                                        "2" = "Chocolate",
                                        "3" = "Strawberry")) %>%
    dplyr::mutate(female = dplyr::recode(female, "0" = "Male", "1" = "Female")) %>%
    dplyr::group_by(ice_cream, female) %>%
    dplyr::summarize(n = n()) %>%
    DT::datatable()

#15 male chocolate lovers out of 47 total chocolate lovers
15/47

# what is the probability you would choose a male chocolate lover?
# pr(male) * pr(chocolate)
table(ice_cream$female)
(91/200) * (47/200)

```

What is the probability of choosing an individual whose favorite flavor is not vanilla?

```{r}

# option 1: prob of not vanilla = 1 - pr(vanilla)!
1-(95/200)

# option 2: prob of not vanilla = pr(choc) + pr(straw)
(47/200) + (58/200)

# or
(47+58)/200

```

# Lecture 03


# Lecture 04

## Binomial random distributions

Which of the variables in our dataset could be classified as 'binomial'?

* binary
* independent
* fixed n
* same p

```{r}
print("female!")
```

If you randomly chose 5 individuals , what is the probability that that all five would be female?

```{r}

# 109 females out of 200
table(ice_cream$female)

# probability that any one individual is female = 109/200
pr <- 109/200

# probability of multiple, independent events * number of possibilities
# pr(female) * pr(female) * pr(female) * pr(female) * pr(female) * choose(5,5)
pr**5 * choose(5,5)

# using dbinom(x, size, prob)
dbinom(5, 5, 109/200)

```

If you randomly chose 5 individuals , what is the probability that that only two would be female?

```{r}

# using dbinom(x, size, prob)
dbinom(2, 5, 109/200)

# using equation
# Pr(females)^(num females)*(Pr(males)^(num males))*combinatorial
(pr**2)*(1-pr)**3*(choose(5,2))

```

If you randomly chose 5 individuals , what is the probability that that **at least two** would be female?

```{r}

# 109 females out of 200
table(ice_cream$female)

# probability that any one individual is female = 109/200
pr <- 109/200

# using dbinom(x, size, prob)
# AT LEAST 2 = 2 OR 3 OR 4 OR 5
dbinom(2, 5, 109/200) + dbinom(3, 5, 109/200) + dbinom(4, 5, 109/200) + dbinom(5, 5, 109/200)

# alternatively, probability of NOT getting 1 or 0
1-(dbinom(1, 5, 109/200)+ dbinom(0, 5, 109/200))

```

## Normal distribution

Let's approximate the video scores as a normal distribution with a mean of `r mean(ice_cream$video)` and standard deviation `r sd(ice_cream$video)`. What is the probability that an individual scored lower than 60?

What is the probability that an individual scores between 40 and 57?

What is the probability than an individaul scores over 50?

```{r}

# we can use pnorm with our mean and sd!
pnorm(60, mean = mean(ice_cream$video), sd = sd(ice_cream$video))

# pr(57) - pr(40) to get the range between values
pnorm(57, mean = mean(ice_cream$video), sd = sd(ice_cream$video))-pnorm(40, mean = mean(ice_cream$video), sd = sd(ice_cream$video))

# probability of scoring greater than 50 = 1-pr(50)
1-pnorm(50, mean = mean(ice_cream$video), sd = sd(ice_cream$video))

```

# Lecture 05

## Sampling distribution

Take a random sample of 10 individuals' video scores and calculate the sample mean and standard deviation. Does it match to your expectations?

```{r}

video_sample <- sample(ice_cream$video, size = 10)

# mean of population = 52.405 = mean sample
mean(ice_cream$video)
mean(video_sample) # yes!

# sd of population = 10.7
sd(ice_cream$video)

# sd of sample = sd(pop)/sqrt(n)
sd(ice_cream$video)/sqrt(10)
# sd(video_sample) # why is this wrong??

```

If you take any given sample of 10 individuals' video scores, what is the probability that the average video score will be greater than 60?

```{r}

# use pnorm!
1-pnorm(60, mean = mean(ice_cream$video), sd = sd(ice_cream$video)/sqrt(10))

```

### BONUS

Take 20 samples of 10 individuals each (video scores) and plot the sample distribution. What is the shape? How does it change with 100 samples?

```{r}

# take 20 samples
sample_dist <- data.frame(rep = seq(1:20)) %>%
    dplyr::rowwise() %>%
    dplyr::mutate(sample_mean = mean(sample(ice_cream$video, 10)))

# plot sample mean distribution
sample_dist %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = sample_mean) +
    ggplot2::geom_density() +
    ggplot2::theme_bw(24)
    # ggplot2::geom_histogram(bins = 10)

# try again with 100 samples
sample_dist <- data.frame(rep = seq(1:100)) %>%
    dplyr::rowwise() %>%
    dplyr::mutate(sample_mean = mean(sample(ice_cream$video, 10)))

# plot sample mean distribution
sample_dist %>%
    ggplot2::ggplot(.) +
    ggplot2::aes(x = sample_mean) +
    ggplot2::geom_density() +
    ggplot2::theme_bw(24)

print("Normal distribution! Becomes more normal as n increases.")

```

### BONUS #2

*something with binomial and normal distributions*

```{r}


```

# Lecture 06

## Standard error of the mean

Calculate the standard error of the mean of an estimate of video score taken from 10 individuals. What does the standard error mean in words?

```{r}

# standard error = sd/sqrt(n)
video_sample <- sample(ice_cream$video, size = 10)

sd(video_sample)/sqrt(10)

print("The standard error of the mean is a measure of precision of the mean estimate from the sample.")

```

## Confidence interval

For your samples calculated above, calculate the confidence interval surrounding the estimation of the mean.

```{r}

# confidence interval (95%) = sample_mean +/- t_0.025 (sample_SE)

# first we need to find t_0.025, what are our degress of freedom?
# df = n - 1
df = 9

# can use the qt(p, df) function to find the test statistic
# p = 0.975 (1 - 0.025)
t <- qt(0.975, 9)

# st error from previous question
se <- sd(video_sample)/sqrt(10)

# plug in!
mean(video_sample) - t*se
mean(video_sample) + t*se

# state conclusion:
print("We are 95% confident that the true mean in video scores lies betwen 43.62 and 55.77")

print(glue::glue("The actual mean of the video scores is: {mean(ice_cream$video)}, which is within our 95% confidence interval."))

```

## Assessing normality

Is the video scores data approximately normal? What about the puzzle scores data? Why can't we assess normality for the gender and ice cream flavor variables?

```{r}



```

# Lecture 07

## Hypothesis testing

If we expect the sample mean to be equal to the population mean, what would be the null and alternative hypotheses in such an analysis?

```{r}

print("H_0: Sample mean of video scores is equal to the population mean.")
print("H_A: Sample mean of video scores is NOT equal to the population mean.")

```

Find the test statistic, t, to choose between these two hypotheses above

```{r}

# test statistic t = (sample_mean - population mean) / (standard error of sample)
t <- (mean(video_sample) - mean(ice_cream$video)) / se
t

```

Given your sample, do you reject or fail to reject the null hypothesis?

#### The t.test is slightly different...

```{r}

# we can use pt(t, df) to find the area under the curve at our test statistic, t
pt(t, df)

# we need to multiply by 2 because this is a two-tailed test, we are looking for the area under the curve on BOTH sides of our t statistic
2*pt(t, df)

# thats good! If there was a difference I might be worried... ;)
print("At a significance level alpha = 0.05, we fail to reject the null hypothesis (P-value = 0.4436). Our data suggests there is no statistically signficant difference between the sample and population mean.")

# lets also try the t.test() in R!
t.test(video_sample, mu = mean(ice_cream$video))

# yay! it matches our math!

```

## Type I and Type II Errors

Let's say your analysis leads you to reject the null hypothesis, but in reality the sample mean is equal to the population mean. What type of error have you made and how could you decrease the probability of this type of error?

```{r}

print("Since we rejected the null hypothesis when we should have accepted it, this is an example of a TYPE I ERROR. We can decrease the probability of a TYPE I ERROR by decreasing the alpha significance level from 0.05 to 0.01, for example.")

```

What was the power for this test?

```{r}

# power = 1 - Beta (beta = prob of type II error)
# we can use power.t.test!
power.t.test(n = 10, 
             delta = mean(video_sample) - mean(ice_cream$video), 
             sd = sd(video_sample), 
             sig.level = 0.05, 
             type = "one.sample")

# power is 0.107 - we have very low power to detect a difference between means!

```

What are some things you could do to increase the power? What is the most practical way to increase power?

```{r}

print("You could increase the sample size, increase the difference in means, decrease the standard deviation or increase alpha. The easiest thing to control is likely the sample size.")

```

Calculate the statistical effect size of the difference between the population and sample means. BONUS: plot the two distributions.

```{r}

# effect size = diff in means / sd
abs(mean(video_sample) - mean(ice_cream$video))/sd(video_sample)

# this is a pretty small difference! They differ by 0.25 SD

# plot!



```

# Lecture 08

## Comparing populations - t test

Split the original population of individuals into males and females. Perform a statistical analysis to determine if males are more likely to score higher on the puzzle than females.

```{r}

# split into two populations, male and female
males <- ice_cream %>%
    dplyr::filter(female == 0)

females <- ice_cream %>%
    dplyr::filter(female == 1)

# easy way - we can use t.test!
t.test(males$puzzle, females$puzzle)

print("Our data suggest that there is no difference in puzzle scores between males and females (P = 0.46)")


```

## Paired sample designs

Let's say we wanted to perform a statistical analysis to decide if the video game scores are statistically different from the puzzle scores. Would it be more appropriate to use an unpaired or paired-sample analysis? Why?

```{r}

print("It might be more appropriate to use a paired sample design in this case, if it was set up in this way, because we gathered puzzle and video data on EACH sample. Using a unpaired analysis could result in a higher standard variation and break the assumption that each observation is independent.")

```

Perform the analysis detailed above. What is the result?

```{r}

# lets calculate ourself first and then test with t.test
# first - calculate diff between video and puzzle scores
diff <- ice_cream %>%
    dplyr::mutate(diff = puzzle - video)

# now we calculate the mean and sd
mean_diff <- mean(diff$diff)
sd_diff <- sd(diff$diff)

# calculate the SE
# se = sd / sqrt(n) - n = 200, not 400!
se_diff <- sd_diff/sqrt(200)

# calculate confidence interval of mean estimate
# 95% CI = mean +/- t_0.025(SE)

# find t
# use qt(p, df)
t <- qt(0.975, 200-1)

mean_diff - t*se_diff
mean_diff + t*se_diff

# calculate test statistic t_s
# t_s = diff - 0 / SE
t_s <- mean_diff/se_diff

# calculate the p-value (area under the curve) at our test statistic - times by 2
# we want the area to the right of the t_s and to the left of -t_s, sometimes helpful to draw a quick sketch
2*(1-pt(t_s, 199))

# we can use t.test to verify we did it right... and we did! woo!
t.test(ice_cream$puzzle, ice_cream$video, paired = T)

# our results:
print("Our data suggests there is not a statistically significant difference between video scores and puzzle scores (p = 0.46).")

```

## BONUS

Repeat the analysis above but with the other type of analysis (i.e. if you chose an unpaired test, repeat with a paired test). What do you notice that is different between the two?

```{r}

# lets try with t.test to save time...
t.test(ice_cream$puzzle, ice_cream$video, paired = F)

print("p-value is higher, df is higher, and confidence interval is wider. there is more variation and less precision in the estimate.")

```

## BONUS: Power

You would like to perform an observational study on this population of individuals to see if individuals who like vanilla scored higher on the video game than individuals who like strawberry ice cream (ignore chocolate ice cream fans for now). However, you are running out of time because your assignment is due tomorrow! Perform a power analysis to decide how many individuals you would need to sample in order to have high enough power (0.8) to detect a significant difference if one does exist. 

```{r}

# we can use power.t.test to calculate the power given n, diff, sd, and alpha
# first calculate power at one n: say n = 5
# we can estimate sd by using the population sd -- but for which population?
# we can set alpha = 0.05
# we can estimate diff by calculating the population diff
strawberry <- ice_cream %>%
    dplyr::filter(ice_cream == 3)
vanilla <- ice_cream %>%
    dplyr::filter(ice_cream == 1)

# calculate means of each group and then get the difference to estimate delta
mean(strawberry$video) - mean(vanilla$video)
sd(strawberry$video)
sd(vanilla$video)

# calculate power - choose one population to set the sd
power.t.test(n = 10, sig.level = 0.05, delta = 3.743, sd = sd(strawberry$video))

# power = 0.125

# now we can calculate our n for a power of 0.8!
power.t.test(power = 0.8, sig.level = 0.05, delta = 3.743, sd = sd(strawberry$video))

print("We would need to sample 109 individuals in order to detect a true difference in video game score between individuals who like strawberry versus vanilla ice cream.")

```



